<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArtSpace - ‡∏≠‡∏≤‡∏ì‡∏≤‡∏à‡∏±‡∏Å‡∏£‡∏á‡∏≤‡∏ô‡∏®‡∏¥‡∏•‡∏õ‡πå</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&family=Prompt:wght@400;600;700&display=swap');

        :root {
            --bg-color: #faf9f6;
            --text-main: #2d3436;
            --text-muted: #636e72;
            --accent: #6c5ce7;
            --accent-hover: #5849be;
            --danger: #ff4757;
            --gold: #f1c40f;
            --glass: rgba(255, 255, 255, 0.9);
            --shadow-md: 0 10px 30px rgba(0,0,0,0.06);
            --radius-lg: 24px;
            --radius-md: 16px;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            overflow-x: hidden; 
        }

        .hidden { display: none !important; }

        /* ================= NAVIGATION ================= */
        nav {
            position: sticky; top: 0; z-index: 100;
            background: var(--glass); backdrop-filter: blur(12px);
            padding: 15px 40px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .logo { font-family: 'Prompt', sans-serif; font-size: 24px; font-weight: 700; color: var(--text-main); display: flex; align-items: center; gap: 10px; cursor: pointer;}
        .logo span { color: var(--accent); }
        
        .search-bar { position: relative; width: 350px; }
        .search-bar input {
            width: 100%; padding: 10px 20px 10px 40px; border-radius: 50px; border: 1px solid #dfe6e9;
            background: #fff; font-family: 'Sarabun'; outline: none; transition: 0.3s;
        }
        .search-bar i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #b2bec3; }

        .btn-nav {
            background: transparent; border: 1px solid transparent; padding: 8px 16px; border-radius: 12px;
            font-weight: 600; color: var(--text-muted); cursor: pointer; transition: 0.2s; font-family: 'Prompt';
        }
        .btn-nav:hover { background: rgba(0,0,0,0.03); color: var(--text-main); }
        .btn-primary { background: var(--accent); color: white !important; box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3); }
        .btn-primary:hover { background: var(--accent-hover); transform: translateY(-2px); }

        /* ================= TOP ARTISTS ================= */
        .top-artists-section {
            padding: 40px 20px; text-align: center;
            background: linear-gradient(180deg, #fff 0%, var(--bg-color) 100%);
        }
        .section-title { font-family: 'Prompt'; font-size: 28px; margin-bottom: 30px; font-weight: 700; }
        .section-title span { color: var(--accent); }
        
        .top-grid {
            display: flex; justify-content: center; gap: 40px; flex-wrap: wrap; max-width: 1000px; margin: 0 auto;
        }
        .artist-rank-card {
            background: white; padding: 20px; border-radius: 20px; width: 220px;
            box-shadow: var(--shadow-md); position: relative; transition: 0.3s;
            display: flex; flex-direction: column; align-items: center;
        }
        .artist-rank-card:hover { transform: translateY(-10px); }
        .rank-badge {
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            background: var(--gold); color: white; width: 35px; height: 35px;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-family: 'Prompt'; box-shadow: 0 4px 10px rgba(241, 196, 15, 0.4);
        }
        .rank-2 .rank-badge { background: #b2bec3; } /* Silver */
        .rank-3 .rank-badge { background: #d35400; } /* Bronze */
        
        .artist-img { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; border: 3px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .artist-name { font-weight: 600; font-size: 18px; margin-bottom: 5px; font-family: 'Prompt'; }
        .artist-sales { font-size: 14px; color: var(--text-muted); }
        .artist-sales i { color: var(--accent); }

        /* ================= GALLERY ================= */
        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px 100px; }
        .filters { display: flex; justify-content: center; gap: 15px; margin-bottom: 40px; flex-wrap: wrap; }
        .filter-btn {
            padding: 10px 25px; border-radius: 30px; border: 1px solid #dfe6e9; background: white;
            color: var(--text-muted); font-family: 'Prompt'; cursor: pointer; transition: 0.3s;
        }
        .filter-btn:hover, .filter-btn.active { background: var(--text-main); color: white; border-color: var(--text-main); }
        
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 30px; }
        
        .art-card {
            background: white; border-radius: var(--radius-md); overflow: hidden; box-shadow: var(--shadow-md);
            transition: all 0.3s ease; position: relative;
        }
        .art-card:hover { transform: translateY(-8px); }
        
        .card-img-container { position: relative; height: 260px; overflow: hidden; cursor: pointer; }
        .card-img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .art-card:hover .card-img { transform: scale(1.05); }
        
        /* Overlay on Hover */
        .card-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.3); opacity: 0; transition: 0.3s;
            display: flex; justify-content: center; align-items: center;
        }
        .card-img-container:hover .card-overlay { opacity: 1; }
        .view-btn {
            background: white; color: var(--text-main); padding: 10px 20px;
            border-radius: 30px; font-weight: bold; font-size: 14px;
            transform: translateY(20px); transition: 0.3s;
        }
        .card-img-container:hover .view-btn { transform: translateY(0); }

        .delete-btn {
            position: absolute; top: 10px; right: 10px; 
            background: var(--danger); color: white; border: none;
            width: 35px; height: 35px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; z-index: 10; opacity: 0; transition: 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .art-card:hover .delete-btn { opacity: 1; }

        .card-body { padding: 20px; }
        .card-title { font-family: 'Prompt'; font-weight: 600; font-size: 16px; margin: 0 0 5px 0; }
        .card-price { font-family: 'Prompt'; font-weight: 700; color: var(--accent); font-size: 18px; margin-top: 10px; }

        /* ================= MODAL & PREVIEW ================= */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 2000; display: none;
            justify-content: center; align-items: center; padding: 20px;
            opacity: 0; transition: opacity 0.3s; backdrop-filter: blur(5px);
        }
        .modal.open { display: flex; opacity: 1; }
        
        .preview-box {
            background: white; border-radius: 20px; overflow: hidden; max-width: 900px; width: 100%;
            display: flex; box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: slideUp 0.4s ease;
        }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .preview-img { flex: 1.5; background: #f1f2f6; display: flex; align-items: center; justify-content: center; }
        .preview-img img { max-width: 100%; max-height: 500px; object-fit: contain; }
        
        .preview-info { flex: 1; padding: 40px; display: flex; flex-direction: column; justify-content: center; }
        .preview-title { font-family: 'Prompt'; font-size: 32px; font-weight: 700; margin-bottom: 10px; }
        .preview-artist { color: var(--text-muted); font-size: 16px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;}
        .preview-desc { color: #636e72; line-height: 1.6; margin-bottom: 30px; }
        .preview-price { font-size: 36px; color: var(--accent); font-weight: bold; font-family: 'Prompt'; margin-bottom: 30px; }
        
        .buy-btn {
            background: var(--accent); color: white; border: none; padding: 15px;
            border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer;
            width: 100%; transition: 0.2s; font-family: 'Prompt'; display: flex; justify-content: center; gap: 10px;
        }
        .buy-btn:hover { background: var(--accent-hover); transform: scale(1.02); }
        
        .close-preview { position: absolute; top: 20px; right: 20px; color: white; font-size: 30px; cursor: pointer; }

        /* ================= AUTH FORM ================= */
        .auth-container {
            background: white; width: 400px; padding: 40px; border-radius: 24px; text-align: center;
        }
        .form-control { width: 100%; padding: 12px; border: 1px solid #dfe6e9; border-radius: 12px; margin-bottom: 15px; box-sizing: border-box; }

        /* Responsive */
        @media (max-width: 768px) {
            .preview-box { flex-direction: column; }
            .preview-img img { max-height: 300px; }
            .top-grid { flex-direction: column; align-items: center; }
        }
    </style>
</head>
<body>

    <div id="auth-modal" class="modal">
        <div class="auth-container">
            <div style="text-align: right; cursor: pointer;" onclick="closeModal('auth-modal')"><i class="fas fa-times"></i></div>
            <h2 style="margin-bottom: 20px; font-family: 'Prompt';">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h2>
            
            <div id="login-section">
                <form onsubmit="handleLogin(event)">
                    <input type="email" id="loginEmail" class="form-control" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏• (admin@artspace.com)" required>
                    <input type="password" id="loginPass" class="form-control" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (admin888)" required>
                    <button type="submit" class="buy-btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </form>
                <p style="margin-top: 15px; font-size: 14px; color: #636e72;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <span style="color: var(--accent); cursor: pointer;" onclick="toggleAuthMode()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span></p>
            </div>

            <div id="register-section" class="hidden">
                <form onsubmit="handleRegister(event)">
                    <input type="text" id="regName" class="form-control" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏™‡∏î‡∏á" required>
                    <input type="email" class="form-control" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" required>
                    <input type="password" class="form-control" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
                    <button type="submit" class="buy-btn">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>
                </form>
                <p style="margin-top: 15px; font-size: 14px; color: #636e72;">‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? <span style="color: var(--accent); cursor: pointer;" onclick="toggleAuthMode()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</span></p>
            </div>
        </div>
    </div>

    <div id="preview-modal" class="modal">
        <div class="close-preview" onclick="closeModal('preview-modal')"><i class="fas fa-times"></i></div>
        <div class="preview-box">
            <div class="preview-img">
                <img id="modal-img" src="" alt="">
            </div>
            <div class="preview-info">
                <h2 id="modal-title" class="preview-title">Title</h2>
                <div class="preview-artist"><i class="fas fa-user-circle"></i> <span id="modal-artist">Artist</span></div>
                <p class="preview-desc">‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå‡∏î‡πâ‡∏ß‡∏¢‡∏à‡∏¥‡∏ô‡∏ï‡∏ô‡∏≤‡∏Å‡∏≤‡∏£ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡∏á‡∏≤‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏ó‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏π‡∏á</p>
                <div id="modal-price" class="preview-price">‡∏ø0</div>
                <button class="buy-btn" onclick="buyItem()"><i class="fas fa-shopping-cart"></i> ‡∏ã‡∏∑‡πâ‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ</button>
            </div>
        </div>
    </div>

    <nav>
        <div class="logo" onclick="resetView()"><i class="fas fa-palette"></i> Art<span>Space</span></div>
        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô, ‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏û..." onkeyup="searchGallery()">
        </div>
        
        <div id="guest-nav">
            <button class="btn-nav" onclick="openAuthModal()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            <button class="btn-nav btn-primary" onclick="openAuthModal('register')">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
        </div>

        <div id="user-nav" class="hidden" style="display: flex; align-items: center; gap: 15px;">
            <button class="btn-nav" id="my-studio-btn" onclick="filterMyArtworks()" style="border: 1px solid var(--accent); color: var(--accent);">
                <i class="fas fa-store"></i> ‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
            </button>
            <div class="user-profile">
                <div style="text-align: right;">
                    <div id="display-name" style="font-weight: bold; font-size: 14px;">User</div>
                    <div id="display-role" style="font-size: 12px; color: #636e72;">Member</div>
                </div>
                <div style="width: 40px; height: 40px; background: var(--accent); border-radius: 50%; color: white; display: flex; justify-content: center; align-items: center; font-weight: bold;" id="avatar-circle">U</div>
            </div>
            <button class="btn-nav" onclick="logout()" style="color: var(--danger);"><i class="fas fa-sign-out-alt"></i></button>
        </div>
    </nav>

    <section class="top-artists-section">
        <h2 class="section-title">üèÜ 3 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö <span>‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</span></h2>
        <div class="top-grid" id="top-artists-grid">
            </div>
    </section>

    <div class="container">
        <div id="upload-section" class="hidden" style="background: white; padding: 20px; border-radius: 16px; margin-bottom: 30px; box-shadow: var(--shadow-md);">
            <h3 style="font-family: 'Prompt'; margin-top: 0;"><i class="fas fa-cloud-upload-alt"></i> ‡∏•‡∏á‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
            <form onsubmit="handleUpload(event)" style="display: flex; gap: 10px;">
                <input type="text" id="upTitle" class="form-control" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô" required style="margin:0;">
                <input type="number" id="upPrice" class="form-control" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" required style="margin:0;">
                <select id="upCategory" class="form-control" style="margin:0;">
                    <option value="digital">Digital Art</option>
                    <option value="painting">Painting</option>
                    <option value="photo">Photography</option>
                </select>
                <input type="file" id="upImage" class="form-control" accept="image/*" required style="margin:0;">
                <button type="submit" class="btn-primary" style="border:none; border-radius: 12px; padding: 0 20px; cursor: pointer;">‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
            </form>
        </div>

        <div class="filters">
            <button class="filter-btn active" onclick="filterGallery('all', this)">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            <button class="filter-btn" onclick="filterGallery('digital', this)">‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡∏≠‡∏≤‡∏£‡πå‡∏ï</button>
            <button class="filter-btn" onclick="filterGallery('painting', this)">‡∏†‡∏≤‡∏û‡∏ß‡∏≤‡∏î‡∏°‡∏∑‡∏≠</button>
            <button class="filter-btn" onclick="filterGallery('photo', this)">‡∏†‡∏≤‡∏û‡∏ñ‡πà‡∏≤‡∏¢</button>
        </div>

        <div class="gallery-grid" id="gallery">
            </div>
    </div>

    <script>
        // ================= DATA & STATE =================
        let currentUser = null; // Store logged in username
        let isAdmin = false;

        // Mock Data with Sales Count
        let artworks = [
            // Digital Art (1-8)
            { id: 1, title: "Forest Guardian", artist: "Samurai_X", price: 15900, category: "digital", img: "img/1.jpg", sales: 120 },
            { id: 2, title: "Surreal Tides", artist: "Dreamer_Art", price: 12500, category: "digital", img: "img/2.jpg", sales: 85 },
            { id: 3, title: "Winter's Mercy", artist: "Bushido_Spirit", price: 25000, category: "digital", img: "img/3.jpg", sales: 200 },
            { id: 4, title: "The Ronin's Path", artist: "Ink_Master", price: 18000, category: "digital", img: "img/4.jpg", sales: 45 },
            { id: 5, title: "Sacred Gateway", artist: "Nature_Zen", price: 8900, category: "digital", img: "img/5.jpg", sales: 300 },
            { id: 6, title: "Cursed Eye", artist: "Anime_God", price: 14500, category: "digital", img: "img/6.jpg", sales: 150 },
            { id: 7, title: "Crimson Horizon", artist: "Red_Sun", price: 11000, category: "digital", img: "img/7.jpg", sales: 90 },
            { id: 8, title: "Dragon's Mark", artist: "Gang_Leader", price: 9500, category: "digital", img: "img/8.jpg", sales: 60 },
            
            // Painting (9-16)
            { id: 9, title: "Watercolor Flower", artist: "SoftBrush", price: 4500, category: "painting", img: "img/9.jpg", sales: 40 },
            { id: 10, title: "Oil Abstract", artist: "PaletteKnife", price: 6200, category: "painting", img: "img/10.jpg", sales: 25 },
            { id: 11, title: "Classic Portrait", artist: "ClassicMaster", price: 3500, category: "painting", img: "img/11.jpg", sales: 15 },
            { id: 12, title: "Sunset Vibe", artist: "ColorBlind", price: 5000, category: "painting", img: "img/12.jpg", sales: 70 },
            { id: 13, title: "Modern Art", artist: "Modernist", price: 4200, category: "painting", img: "img/13.jpg", sales: 30 },
            { id: 14, title: "Nature Canvas", artist: "EcoArt", price: 5800, category: "painting", img: "img/14.jpg", sales: 55 },
            { id: 15, title: "Acrylic Flow", artist: "FluidArt", price: 7000, category: "painting", img: "img/15.jpg", sales: 80 },
            { id: 16, title: "Impressionist", artist: "OldSchool", price: 8500, category: "painting", img: "img/16.jpg", sales: 10 },
            
            // Photography (17-24)
            { id: 17, title: "Mountain View", artist: "NatureLover", price: 8900, category: "photo", img: "img/17.jpg", sales: 110 },
            { id: 18, title: "City Night", artist: "StreetShooter", price: 25000, category: "photo", img: "img/18.jpg", sales: 180 },
            { id: 19, title: "Street Life", artist: "CityWalker", price: 9200, category: "photo", img: "img/19.jpg", sales: 65 },
            { id: 20, title: "Golden Hour", artist: "SunChaser", price: 6500, category: "photo", img: "img/20.jpg", sales: 95 },
            { id: 21, title: "Minimalist", artist: "ZenPhoto", price: 13500, category: "photo", img: "img/21.jpg", sales: 130 },
            { id: 22, title: "Portrait B&W", artist: "MonoLens", price: 5500, category: "photo", img: "img/22.jpg", sales: 40 },
            { id: 23, title: "Urban Decay", artist: "RustyCam", price: 4800, category: "photo", img: "img/23.jpg", sales: 20 },
            { id: 24, title: "Forest Mist", artist: "GreenEye", price: 7200, category: "photo", img: "img/24.jpg", sales: 50 }
        ];

        // ================= CORE FUNCTIONS =================
        function init() {
            renderTopArtists();
            renderGallery(artworks);
        }

        // 1. Render Top 3 Artists Logic
        function renderTopArtists() {
            // Sort by sales descending
            const sorted = [...artworks].sort((a, b) => b.sales - a.sales).slice(0, 3);
            const container = document.getElementById('top-artists-grid');
            
            container.innerHTML = sorted.map((item, index) => `
                <div class="artist-rank-card rank-${index + 1}" onclick="openPreview(${item.id})">
                    <div class="rank-badge">${index + 1}</div>
                    <img src="${item.img}" class="artist-img">
                    <div class="artist-name">${item.artist}</div>
                    <div class="artist-sales"><i class="fas fa-fire"></i> ‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß ${item.sales} ‡∏ä‡∏¥‡πâ‡∏ô</div>
                    <div style="font-size:12px; color:#b2bec3; margin-top:5px;">${item.title}</div>
                </div>
            `).join('');
        }

        // 2. Render Gallery Logic
        function renderGallery(items) {
            const gallery = document.getElementById('gallery');
            const fallback = 'https://placehold.co/600x400/EEE/31343C?text=Art+Space';

            if(items.length === 0) {
                gallery.innerHTML = `<div style="grid-column:1/-1; text-align:center; padding:50px; color:#b2bec3;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏á‡∏≤‡∏ô</div>`;
                return;
            }

            gallery.innerHTML = items.map(item => {
                // Logic: Show Delete Button if Admin OR if Current User owns the art
                const canDelete = isAdmin || (currentUser && item.artist === currentUser);
                const deleteBtn = canDelete ? 
                    `<button class="delete-btn" onclick="deleteArt(${item.id}, event)"><i class="fas fa-trash"></i></button>` : '';

                let badge = item.category === 'digital' ? 'Digital' : item.category === 'photo' ? 'Photo' : 'Paint';

                return `
                <div class="art-card">
                    <div class="card-img-container" onclick="openPreview(${item.id})">
                        <span class="category-badge">${badge}</span>
                        ${deleteBtn}
                        <div class="card-overlay">
                            <span class="view-btn">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</span>
                        </div>
                        <img src="${item.img}" class="card-img" loading="lazy" onerror="this.src='${fallback}'">
                    </div>
                    <div class="card-body">
                        <h4 class="card-title">${item.title}</h4>
                        <div style="font-size:13px; color:#636e72;">
                            <i class="fas fa-user-circle"></i> ${item.artist}
                        </div>
                        <div class="card-price">‡∏ø${item.price.toLocaleString()}</div>
                    </div>
                </div>
                `;
            }).join('');
        }

        // 3. Modal Preview & Buy Logic
        function openPreview(id) {
            const item = artworks.find(a => a.id === id);
            if(!item) return;

            document.getElementById('modal-img').src = item.img;
            document.getElementById('modal-title').textContent = item.title;
            document.getElementById('modal-artist').textContent = item.artist;
            document.getElementById('modal-price').textContent = `‡∏ø${item.price.toLocaleString()}`;
            
            // Show Modal
            const modal = document.getElementById('preview-modal');
            modal.classList.add('open');
        }

        function buyItem() {
            if(!currentUser) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠');
                closeModal('preview-modal');
                openAuthModal();
                return;
            }
            alert('‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏®‡∏¥‡∏•‡∏õ‡∏∞! ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏≤‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô...');
            closeModal('preview-modal');
        }

        // ================= FILTER & SEARCH =================
        function filterGallery(cat, btn) {
            // Reset nav button style
            document.getElementById('my-studio-btn').style.background = 'transparent';
            document.getElementById('my-studio-btn').style.color = 'var(--accent)';

            // Set active class for filter buttons
            if(btn) {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }

            if(cat === 'all') {
                renderGallery(artworks);
            } else {
                const filtered = artworks.filter(item => item.category === cat);
                renderGallery(filtered);
            }
        }

        function filterMyArtworks() {
            if(!currentUser) return;
            
            // Highlight My Studio Button
            const btn = document.getElementById('my-studio-btn');
            btn.style.background = 'var(--accent)';
            btn.style.color = 'white';
            
            // Reset other filters
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));

            const myWorks = artworks.filter(item => item.artist === currentUser);
            renderGallery(myWorks);
        }

        function searchGallery() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const filtered = artworks.filter(item => 
                item.title.toLowerCase().includes(term) || 
                item.artist.toLowerCase().includes(term)
            );
            renderGallery(filtered);
        }

        // ================= AUTHENTICATION =================
        function openAuthModal(mode = 'login') {
            document.getElementById('auth-modal').classList.add('open');
            // Toggle form view
            if(mode === 'register') {
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('register-section').classList.remove('hidden');
            } else {
                document.getElementById('login-section').classList.remove('hidden');
                document.getElementById('register-section').classList.add('hidden');
            }
        }

        function toggleAuthMode() {
            document.getElementById('login-section').classList.toggle('hidden');
            document.getElementById('register-section').classList.toggle('hidden');
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;

            if(email === 'admin@artspace.com' && pass === 'admin888') {
                loginSuccess("Admin", true);
            } else {
                loginSuccess("Somchai Arts", false);
            }
        }

        function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('regName').value;
            loginSuccess(name, false);
        }

        function loginSuccess(name, isSuperUser) {
            currentUser = name;
            isAdmin = isSuperUser;
            closeModal('auth-modal');

            // UI Update
            document.getElementById('guest-nav').classList.add('hidden');
            document.getElementById('user-nav').classList.remove('hidden'); // Fix: remove hidden to show
            document.getElementById('user-nav').style.display = 'flex'; // Ensure display flex
            
            document.getElementById('display-name').textContent = name;
            document.getElementById('avatar-circle').textContent = name.charAt(0).toUpperCase();
            document.getElementById('display-role').textContent = isAdmin ? 'Administrator' : 'Artist Member';
            document.getElementById('display-role').style.color = isAdmin ? 'var(--danger)' : '#636e72';

            document.getElementById('upload-section').classList.remove('hidden');

            alert(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì ${name}`);
            renderGallery(artworks); // Re-render to show delete buttons
        }

        function logout() {
            if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?')) {
                currentUser = null;
                isAdmin = false;
                document.getElementById('guest-nav').classList.remove('hidden');
                document.getElementById('user-nav').classList.add('hidden');
                document.getElementById('upload-section').classList.add('hidden');
                document.getElementById('user-nav').style.display = 'none';
                
                resetView();
            }
        }

        // ================= ACTIONS =================
        function handleUpload(e) {
            e.preventDefault();
            const title = document.getElementById('upTitle').value;
            const price = document.getElementById('upPrice').value;
            const cat = document.getElementById('upCategory').value;
            const file = document.getElementById('upImage').files[0];

            if(file) {
                const reader = new FileReader();
                reader.onload = function(evt) {
                    const newArt = {
                        id: Date.now(), // Unique ID
                        title: title,
                        artist: currentUser, // Owner is current user
                        price: Number(price),
                        category: cat,
                        img: evt.target.result,
                        sales: 0
                    };
                    artworks.unshift(newArt); // Add to top
                    renderGallery(artworks);
                    e.target.reset();
                    alert('‡∏•‡∏á‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
                }
                reader.readAsDataURL(file);
            }
        }

        function deleteArt(id, event) {
            event.stopPropagation(); // Prevent opening modal
            if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ?')) {
                artworks = artworks.filter(item => item.id !== id);
                // Re-render current view
                const isMyStudio = document.getElementById('my-studio-btn').style.background !== 'transparent';
                if(isMyStudio) {
                    filterMyArtworks();
                } else {
                    renderGallery(artworks);
                }
                renderTopArtists(); // Update charts just in case
            }
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('open');
        }

        function resetView() {
            filterGallery('all', document.querySelector('.filter-btn'));
        }

        // Init
        init();

    </script>
</body>
</html>