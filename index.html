<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArtSpace - ‡∏≠‡∏≤‡∏ì‡∏≤‡∏à‡∏±‡∏Å‡∏£‡∏á‡∏≤‡∏ô‡∏®‡∏¥‡∏•‡∏õ‡πå</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&family=Prompt:wght@400;600;700;800&display=swap');

        :root {
            /* --- MODERN DARK THEME --- */
            --bg-color: #0f0f12;
            --card-bg: #1a1a1f;
            --text-main: #ffffff;
            --text-muted: #a0a0b0;
            --accent: #6c5ce7;
            --accent-hover: #5849be;
            --gradient-text: linear-gradient(135deg, #a55eea 0%, #45aaf2 100%);
            --gradient-btn: linear-gradient(90deg, #6c5ce7, #a55eea);
            --danger: #ff4757;
            --success: #2ed573;
            --gold: #ffa502;
            --glass: rgba(26, 26, 31, 0.95);
            --shadow-md: 0 10px 30px rgba(0,0,0,0.3);
            --radius-lg: 24px;
            --radius-md: 16px;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            overflow: hidden;
        }

        .hidden { display: none !important; }

        /* ================= INTRO ANIMATION ================= */
        #intro-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--bg-color);
            z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            transition: transform 1.0s cubic-bezier(0.86, 0, 0.07, 1);
        }
        .curtain-open { transform: translateY(-100%); }
        #animCanvas { position: absolute; top: 0; left: 0; }
        .skip-hint {
            position: absolute; bottom: 50px; color: var(--text-muted);
            font-family: 'Prompt', sans-serif; font-size: 20px; font-weight: 600;
            letter-spacing: 1px; animation: pulse 2s infinite; pointer-events: none;
            z-index: 10000; transition: opacity 0.5s;
        }
        @keyframes pulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }

        /* ================= MAIN SITE ================= */
        #main-site {
            position: relative; z-index: 1; height: 100vh; overflow-y: auto;
            opacity: 0; transition: opacity 0.8s ease;
        }
        .site-visible { opacity: 1 !important; }
        .reveal-element { opacity: 0; transform: translateY(30px); transition: all 0.8s ease; }
        .reveal-active { opacity: 1; transform: translateY(0); }

        /* ================= NAVIGATION ================= */
        nav {
            position: sticky; top: 0; z-index: 100;
            background: var(--glass); backdrop-filter: blur(12px);
            padding: 15px 40px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .logo { font-family: 'Prompt', sans-serif; font-size: 26px; font-weight: 800; color: var(--text-main); display: flex; align-items: center; gap: 10px; cursor: pointer; letter-spacing: -1px;}
        .logo span { background: var(--gradient-text); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .search-bar input {
            width: 350px; padding: 12px 25px; border-radius: 50px; border: 1px solid #333;
            background: #25252b; color: white; outline: none; transition: 0.3s;
        }
        .search-bar input:focus { border-color: var(--accent); box-shadow: 0 0 15px rgba(108, 92, 231, 0.2); }

        .btn-nav {
            background: transparent; border: 1px solid transparent; padding: 8px 16px; border-radius: 12px;
            font-weight: 600; color: var(--text-muted); cursor: pointer; transition: 0.2s; font-family: 'Prompt';
        }
        .btn-nav:hover { color: var(--text-main); }
        .btn-primary { background: var(--gradient-btn); color: white !important; box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3); border: none;}
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(108, 92, 231, 0.5); }

        /* ================= HERO SECTION ================= */
        .hero {
            text-align: center; padding: 80px 20px 40px;
            background: radial-gradient(circle at 50% 0%, rgba(108, 92, 231, 0.15) 0%, transparent 70%);
            transition: all 0.5s ease;
        }
        .hero h1 {
            font-family: 'Prompt', sans-serif; font-size: 64px; margin-bottom: 10px; font-weight: 800;
            line-height: 1.1; letter-spacing: -2px;
        }
        .hero h1 span {
            background: var(--gradient-text); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .hero p {
            color: var(--text-muted); font-size: 20px; font-weight: 300; margin-top: 15px;
        }

        /* ================= TOP ARTISTS ================= */
        .section-header { text-align: center; margin: 40px 0 30px; }
        .section-title { font-family: 'Prompt'; font-size: 24px; font-weight: 700; color: var(--text-main); }
        
        .top-grid { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; margin-bottom: 50px; }
        .artist-rank-card {
            background: var(--card-bg); padding: 20px; border-radius: 20px; width: 220px;
            box-shadow: var(--shadow-md); position: relative; transition: 0.3s;
            display: flex; flex-direction: column; align-items: center; border: 1px solid rgba(255,255,255,0.05);
        }
        .artist-rank-card:hover { transform: translateY(-10px); border-color: var(--accent); }
        
        .rank-badge {
            position: absolute; top: -15px; background: var(--gold); color: #000; width: 35px; height: 35px;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-family: 'Prompt'; box-shadow: 0 4px 10px rgba(255, 165, 2, 0.4);
        }
        .artist-img { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; border: 3px solid var(--card-bg); }
        .artist-name { font-weight: 600; font-size: 18px; margin-bottom: 5px; font-family: 'Prompt'; }
        
        /* ================= GALLERY ================= */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px 100px; }
        
        .filters { display: flex; justify-content: center; gap: 15px; margin-bottom: 40px; flex-wrap: wrap; }
        .filter-btn {
            padding: 10px 25px; border-radius: 30px; border: 1px solid #333; background: var(--card-bg);
            color: var(--text-muted); font-family: 'Prompt'; cursor: pointer; transition: 0.3s;
        }
        .filter-btn:hover, .filter-btn.active { background: var(--text-main); color: #000; border-color: var(--text-main); }
        
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 30px; }
        
        .art-card {
            background: var(--card-bg); border-radius: var(--radius-md); overflow: hidden;
            box-shadow: var(--shadow-md); transition: all 0.3s ease; position: relative;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .art-card:hover { transform: translateY(-8px); box-shadow: 0 15px 40px rgba(108, 92, 231, 0.15); }
        
        .card-img-container { position: relative; height: 280px; overflow: hidden; cursor: pointer; }
        .card-img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .art-card:hover .card-img { transform: scale(1.05); }
        
        .card-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); opacity: 0; transition: 0.3s;
            display: flex; justify-content: center; align-items: center;
        }
        .card-img-container:hover .card-overlay { opacity: 1; }
        .view-btn {
            background: white; color: black; padding: 10px 20px;
            border-radius: 30px; font-weight: bold; font-size: 14px;
            transform: translateY(20px); transition: 0.3s;
        }
        .card-img-container:hover .view-btn { transform: translateY(0); }

        .card-body { padding: 20px; }
        .card-title { font-family: 'Prompt'; font-weight: 600; font-size: 16px; margin: 0 0 5px 0; }
        .card-price { font-family: 'Prompt'; font-weight: 700; color: var(--accent); font-size: 18px; margin-top: 10px; }

        /* Badges */
        .category-badge { position: absolute; top: 10px; left: 10px; padding: 4px 12px; background: rgba(0,0,0,0.6); color: white; font-size: 10px; border-radius: 20px; backdrop-filter: blur(4px); letter-spacing: 1px; z-index: 2; border: 1px solid rgba(255,255,255,0.2); }
        .sold-overlay-badge { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); border: 4px solid var(--danger); color: var(--danger); font-size: 32px; font-weight: 800; padding: 10px 20px; text-transform: uppercase; font-family: 'Prompt', sans-serif; letter-spacing: 2px; background: rgba(0,0,0, 0.8); backdrop-filter: blur(2px); z-index: 5; pointer-events: none; opacity: 0.9; }
        
        /* Grayscale for sold items ONLY when not in 'My Collection' */
        .art-card.sold .card-img { filter: grayscale(100%); opacity: 0.5; }
        /* Reset for My Collection (Dynamic class will handle this) */
        .art-card.owned .card-img { filter: none !important; opacity: 1 !important; }

        .delete-btn { position: absolute; top: 10px; right: 10px; background: var(--danger); color: white; border: none; width: 35px; height: 35px; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; z-index: 10; opacity: 0; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .art-card:hover .delete-btn { opacity: 1; }

        /* ================= MODALS ================= */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 6000; display: none;
            justify-content: center; align-items: center; padding: 20px;
            opacity: 0; transition: opacity 0.3s; backdrop-filter: blur(8px);
        }
        .modal.open { display: flex; opacity: 1; }
        
        .modal-box { 
            background: #25252b; width: 450px; padding: 40px; border-radius: 24px; 
            text-align: center; position: relative; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(255,255,255,0.1); color: white;
        }
        
        .preview-box {
            background: #25252b; border-radius: 20px; overflow: hidden; max-width: 900px; width: 100%;
            display: flex; box-shadow: 0 20px 60px rgba(0,0,0,0.5); animation: slideUp 0.4s ease; position: relative;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .preview-img { flex: 1.5; background: #000; display: flex; align-items: center; justify-content: center; }
        .preview-img img { max-width: 100%; max-height: 500px; object-fit: contain; }
        .preview-info { flex: 1; padding: 40px; display: flex; flex-direction: column; justify-content: center; color: white; }
        .preview-title { font-family: 'Prompt'; font-size: 32px; font-weight: 700; margin-bottom: 10px; }
        
        .buy-btn { width: 100%; padding: 14px; background: var(--gradient-btn); color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-family: 'Prompt'; font-size: 16px; margin-top: 15px;}
        .buy-btn:hover { opacity: 0.9; transform: translateY(-2px); }
        
        .form-control { width: 100%; padding: 12px; border: 1px solid #444; border-radius: 12px; margin-bottom: 15px; box-sizing: border-box; background: #1a1a1f; color: white; }
        .form-control:focus { border-color: var(--accent); outline: none; }
        
        .close-modal { position: absolute; top: 20px; right: 20px; font-size: 20px; cursor: pointer; color: #666; transition: 0.2s; }
        .close-modal:hover { color: white; }

        /* Misc */
        .reset-btn-float { position: fixed; bottom: 20px; right: 20px; background: var(--danger); color: white; border: none; padding: 12px 20px; border-radius: 50px; box-shadow: 0 5px 15px rgba(255, 71, 87, 0.4); cursor: pointer; z-index: 5000; font-family: 'Prompt'; font-weight: bold; transition: 0.3s; }
        .reset-btn-float:hover { transform: scale(1.05); }
        .bank-card { background: linear-gradient(135deg, #0984e3 0%, #74b9ff 100%); color: white; padding: 20px; border-radius: 16px; margin-bottom: 20px; text-align: left; }
        .studio-tabs { display: flex; gap: 15px; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .studio-tab { cursor: pointer; font-family: 'Prompt'; font-weight: bold; color: #666; padding-bottom: 5px; }
        .studio-tab.active { color: var(--accent); border-bottom: 3px solid var(--accent); }
        .link-text { color: var(--accent); cursor: pointer; text-decoration: none; font-weight: bold; }
        .link-text:hover { text-decoration: underline; }

        /* Animations */
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @media (max-width: 768px) { .preview-box { flex-direction: column; } .preview-img img { max-height: 300px; } .hero h1 { font-size: 40px; } }
    </style>
</head>
<body>

    <div id="intro-overlay">
        <canvas id="animCanvas"></canvas>
        <div class="skip-hint">‡∏Å‡∏î Spacebar ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≤‡∏°</div>
    </div>

    <button id="admin-reset-btn" class="reset-btn-float hidden" onclick="systemReset()">
        <i class="fas fa-sync-alt"></i> ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö (Factory Reset)
    </button>

    <div id="auth-modal" class="modal">
        <div class="modal-box">
            <div class="close-modal" onclick="closeModal('auth-modal')"><i class="fas fa-times"></i></div>
            <h2 id="auth-title" style="margin-bottom: 20px; font-family: 'Prompt';">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
            
            <div id="login-section">
                <form onsubmit="handleLogin(event)">
                    <input type="email" id="loginEmail" class="form-control" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏• (admin@artspace.com)" required>
                    <input type="password" id="loginPass" class="form-control" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (admin888)" required>
                    <button type="submit" class="buy-btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </form>
                <p style="margin-top: 15px; font-size: 14px; color: var(--text-muted);">
                    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <span class="link-text" onclick="toggleAuth('register')">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span>
                </p>
            </div>

            <div id="register-section" class="hidden">
                <form onsubmit="handleRegister(event)">
                    <input type="text" id="regName" class="form-control" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏™‡∏î‡∏á (Display Name)" required>
                    <input type="email" id="regEmail" class="form-control" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" required>
                    <input type="password" id="regPass" class="form-control" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
                    <button type="submit" class="buy-btn" style="background: var(--success);">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>
                </form>
                <p style="margin-top: 15px; font-size: 14px; color: var(--text-muted);">
                    ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? <span class="link-text" onclick="toggleAuth('login')">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</span>
                </p>
            </div>
        </div>
    </div>

    <div id="payment-modal" class="modal">
        <div class="modal-box">
            <div class="close-modal" onclick="closeModal('payment-modal')"><i class="fas fa-times"></i></div>
            <h2 style="margin-bottom: 10px; font-family: 'Prompt';">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
            <p style="color:var(--text-muted); margin-bottom:20px;" id="pay-item-name">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ...</p>
            <div class="bank-card">
                <div style="opacity:0.8; font-size:14px;">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏≠‡∏≤‡∏£‡πå‡∏ï‡∏™‡πÄ‡∏õ‡∏ã</div>
                <div style="font-size:24px; font-weight:bold; margin:10px 0; letter-spacing:2px; font-family:'Prompt';">123-4-56789-0</div>
                <div>‡∏ö‡∏à‡∏Å. ‡∏≠‡∏≤‡∏£‡πå‡∏ï‡∏™‡πÄ‡∏õ‡∏ã ‡∏™‡∏ï‡∏π‡∏î‡∏¥‡πÇ‡∏≠</div>
            </div>
            <form onsubmit="confirmPayment(event)">
                <div style="text-align:left; font-size:14px; margin-bottom:5px; color:#aaa;">‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</div>
                <input type="file" class="form-control" accept="image/*" required>
                <div style="text-align:left; font-size:14px; margin-bottom:5px; color:#aaa;">‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞:</div>
                <input type="text" id="pay-amount" class="form-control" readonly style="background: #333; font-weight: bold; color:var(--accent);">
                <button type="submit" class="buy-btn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
            </form>
        </div>
    </div>

    <div id="success-modal" class="modal">
        <div class="modal-box">
            <div style="font-size: 50px; color: var(--success); margin-bottom: 20px;"><i class="fas fa-check-circle"></i></div>
            <h3 style="font-family: 'Prompt'; font-size: 24px; margin-bottom: 10px;">‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!</h3>
            <p style="color: var(--text-muted); margin-bottom: 30px;">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏®‡∏¥‡∏•‡∏õ‡∏∞<br>‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô "‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô" ‡πÅ‡∏•‡πâ‡∏ß</p>
            <button class="buy-btn" onclick="closeModal('success-modal')" style="background: var(--success);">‡∏ï‡∏Å‡∏•‡∏á</button>
        </div>
    </div>

    <div id="preview-modal" class="modal">
        <div class="preview-box">
            <div class="close-modal" onclick="closeModal('preview-modal')" style="z-index:100; color:#333; background:rgba(255,255,255,0.8); width:40px; height:40px; border-radius:50%; display:flex; justify-content:center; align-items:center; top:15px; right:15px;"><i class="fas fa-times"></i></div>
            <div class="preview-img">
                <img id="modal-img" src="" alt="">
            </div>
            <div class="preview-info">
                <h2 id="modal-title" class="preview-title">Title</h2>
                <div style="color:var(--text-muted); margin-bottom:20px; display:flex; align-items:center; gap:10px;">
                    <i class="fas fa-user-circle"></i> <span id="modal-artist">Artist</span>
                </div>
                <p style="color:var(--text-muted); line-height:1.6; margin-bottom:30px;">
                    ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå‡∏î‡πâ‡∏ß‡∏¢‡∏à‡∏¥‡∏ô‡∏ï‡∏ô‡∏≤‡∏Å‡∏≤‡∏£ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡∏á‡∏≤‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏ó‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏π‡∏á
                </p>
                <div id="modal-price" style="font-size:36px; color:var(--accent); font-weight:bold; font-family:'Prompt';">‡∏ø0</div>
                <button id="modal-buy-btn" class="buy-btn" onclick="openPayment()">‡∏ã‡∏∑‡πâ‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ</button>
            </div>
        </div>
    </div>

    <div id="main-site">
        <nav>
            <div class="logo" onclick="resetView()"><i class="fas fa-palette"></i> Art<span>Space</span></div>
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô, ‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏û..." onkeyup="searchGallery()">
            </div>
            
            <div id="guest-nav">
                <button class="btn-nav" onclick="openAuthModal()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                <button class="btn-nav btn-primary" onclick="openAuthModal('register')">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
            </div>

            <div id="user-nav" class="hidden" style="display: flex; align-items: center; gap: 15px;">
                <button class="btn-nav" id="my-studio-btn" onclick="openMyStudio()" style="border: 1px solid var(--accent); color: var(--accent);">
                    <i class="fas fa-store"></i> ‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
                </button>
                <div style="text-align:right;">
                    <div id="display-name" style="font-weight:bold;">User</div>
                    <div id="display-role" style="font-size:12px; color:var(--text-muted);">Member</div>
                </div>
                <button class="btn-nav" onclick="logout()" style="color:var(--danger);"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </nav>

        <div class="hero reveal-element">
            <h1 id="hero-title">‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡∏≤‡∏°<br><span>‡∏ó‡∏µ‡πà‡πÑ‡∏£‡πâ‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î</span></h1>
            <p id="hero-subtitle">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡∏£‡∏±‡∏Å‡∏®‡∏¥‡∏•‡∏õ‡∏∞ ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏≤‡∏ü‡∏ï‡πå‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</p>
        </div>

        <section id="top-artists-section" class="top-artists-section reveal-element">
            <div class="section-header">
                <h2 class="section-title">üèÜ 3 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö <span>‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</span></h2>
            </div>
            <div class="top-grid" id="top-artists-grid"></div>
        </section>

        <div class="container">
            <div id="admin-panel" class="hidden" style="background:var(--card-bg); padding:20px; border-radius:15px; margin-bottom:30px; border:1px solid #333;">
                <h3>üõ°Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Admin Only)</h3>
                <div id="user-list-container" style="margin-top:15px;"></div>
            </div>

            <div id="studio-panel" class="hidden" style="background:var(--card-bg); padding:20px; border-radius:15px; margin-bottom:30px; border:1px solid #333;">
                <div class="studio-tabs">
                    <div class="studio-tab active" id="tab-upload" onclick="switchStudioTab('upload')">üì§ ‡∏•‡∏á‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢</div>
                    <div class="studio-tab" id="tab-collection" onclick="switchStudioTab('collection')">üõçÔ∏è ‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô (‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß)</div>
                </div>
                
                <form id="upload-form" onsubmit="handleUpload(event)" style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <input type="text" id="upTitle" class="form-control" placeholder="‡∏ä‡∏∑‡πà‡∏≠" required style="margin:0; width:150px;">
                    <input type="number" id="upPrice" class="form-control" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" required style="margin:0; width:100px;">
                    <select id="upCategory" class="form-control" style="margin:0; width:120px;">
                        <option value="digital">Digital</option>
                        <option value="painting">Painting</option>
                        <option value="photo">Photo</option>
                    </select>
                    <input type="file" id="upImage" class="form-control" accept="image/*" required style="margin:0; width:200px;">
                    <button type="submit" class="btn-nav btn-primary" style="border:none;">‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
                </form>

                <div id="collection-msg" class="hidden" style="text-align: center; color: var(--accent); padding: 20px;">
                    <i class="fas fa-heart"></i> ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏®‡∏¥‡∏•‡∏õ‡∏∞‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô
                </div>
            </div>

            <div class="filters reveal-element">
                <button class="filter-btn active" onclick="filterGallery('all', this)">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button class="filter-btn" onclick="filterGallery('digital', this)">‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•</button>
                <button class="filter-btn" onclick="filterGallery('painting', this)">‡∏†‡∏≤‡∏û‡∏ß‡∏≤‡∏î</button>
                <button class="filter-btn" onclick="filterGallery('photo', this)">‡∏†‡∏≤‡∏û‡∏ñ‡πà‡∏≤‡∏¢</button>
                <button class="filter-btn" onclick="filterGallery('sold', this)" style="color:var(--danger); border-color:var(--danger);">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</button>
            </div>

            <div class="gallery-grid reveal-element" id="gallery"></div>
        </div>
    </div>

    <script>
        // ================= 1. INTRO ANIMATION =================
        const canvas = document.getElementById('animCanvas');
        const ctx = canvas.getContext('2d');
        const introOverlay = document.getElementById('intro-overlay');
        const mainSite = document.getElementById('main-site');
        const skipHint = document.querySelector('.skip-hint');
        let animId;

        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize); resize();

        const cx = window.innerWidth / 2, cy = window.innerHeight / 2;
        const colors = ['#ff7675', '#74b9ff', '#55efc4', '#ffeaa7', '#a29bfe', '#fd79a8', '#fab1a0', '#81ecec'];
        let balls = []; let particles = [];
        let phase = 'rolling'; let frameCount = 0; const timeToHit = 120;

        for(let i=0; i < 8; i++) {
            const angle = (i * (Math.PI * 2) / 8);
            const dist = Math.max(window.innerWidth, window.innerHeight) * 0.8;
            balls.push({ x: cx + Math.cos(angle) * dist, y: cy + Math.sin(angle) * dist, vx: (cx - (cx + Math.cos(angle) * dist)) / timeToHit, vy: (cy - (cy + Math.sin(angle) * dist)) / timeToHit, color: colors[i % colors.length] });
        }

        function createExplosion() {
            for (let i = 0; i < 250; i++) {
                const color = balls[Math.floor(Math.random() * balls.length)].color;
                particles.push({ x: cx, y: cy, vx: (Math.random() - 0.5) * 60, vy: (Math.random() - 0.5) * 60, radius: Math.random() * 40 + 10, color: color, growthRate: Math.random() * 4 + 3 });
            }
        }

        function animate() {
            if (phase === 'finished') return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (phase === 'rolling') {
                frameCount++;
                balls.forEach(ball => {
                    ball.x += ball.vx; ball.y += ball.vy;
                    ctx.save(); ctx.shadowColor = "rgba(0,0,0,0.15)"; ctx.shadowBlur = 25; ctx.shadowOffsetY = 5;
                    ctx.beginPath(); ctx.arc(ball.x, ball.y, 85, 0, Math.PI * 2); ctx.fillStyle = ball.color; ctx.fill(); ctx.restore();
                });
                if (frameCount >= timeToHit) { phase = 'expanding'; skipHint.style.opacity = '0'; createExplosion(); }
            }
            if (phase === 'expanding') {
                particles.forEach(p => {
                    p.x += p.vx; p.y += p.vy; p.vx *= 0.94; p.vy *= 0.94;
                    p.radius += p.growthRate * 2; p.growthRate *= 1.03; 
                    ctx.beginPath(); ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2); ctx.fillStyle = p.color; ctx.fill();
                });
                const maxSize = particles.reduce((max, p) => p.radius > max ? p.radius : max, 0);
                if (maxSize > Math.sqrt(canvas.width**2 + canvas.height**2) * 0.8) { enterSite(); return; }
            }
            animationFrameId = requestAnimationFrame(animate);
        }
        animate();
        setTimeout(() => { if (!isEntered) enterSite(); }, 4000); 

        let isEntered = false;
        function enterSite() {
            if (isEntered) return;
            isEntered = true; phase = 'finished'; cancelAnimationFrame(animationFrameId);
            introOverlay.classList.add('curtain-open');
            mainSite.style.visibility = 'visible'; mainSite.style.opacity = '1';
            document.body.style.overflowY = 'auto'; 
            document.querySelectorAll('.reveal-element').forEach((el, index) => {
                setTimeout(() => { el.classList.add('reveal-active'); }, 300 + (index * 150));
            });
            setTimeout(() => { introOverlay.style.display = 'none'; }, 1500);
        }
        document.addEventListener('keydown', (e) => { if (e.code === 'Space') enterSite(); });

        // ================= GLOBAL DATA =================
        let currentUser = null; 
        let isAdmin = false;
        let selectedItemForPay = null;
        let users = [];
        let artworks = [];

        const defaultUsers = [
            { email: 'admin@artspace.com', pass: 'admin888', name: 'Admin', role: 'admin' }
        ];
        const defaultArtworks = [
            { id: 1, title: "Forest Guardian", artist: "Samurai_X", price: 15900, category: "digital", img: "img/1.jpg", sales: 120, isSold: false, owner: null },
            { id: 2, title: "Surreal Tides", artist: "Dreamer_Art", price: 12500, category: "digital", img: "img/2.jpg", sales: 85, isSold: false, owner: null },
            { id: 3, title: "Winter's Mercy", artist: "Bushido_Spirit", price: 25000, category: "digital", img: "img/3.jpg", sales: 200, isSold: false, owner: null },
            { id: 4, title: "The Ronin's Path", artist: "Ink_Master", price: 18000, category: "digital", img: "img/4.jpg", sales: 45, isSold: false, owner: null },
            { id: 5, title: "Sacred Gateway", artist: "Nature_Zen", price: 8900, category: "digital", img: "img/5.jpg", sales: 300, isSold: false, owner: null },
            { id: 6, title: "Cursed Eye", artist: "Anime_God", price: 14500, category: "digital", img: "img/6.jpg", sales: 150, isSold: false, owner: null },
            { id: 7, title: "Crimson Horizon", artist: "Red_Sun", price: 11000, category: "digital", img: "img/7.jpg", sales: 90, isSold: false, owner: null },
            { id: 8, title: "Dragon's Mark", artist: "Gang_Leader", price: 9500, category: "digital", img: "img/8.jpg", sales: 60, isSold: false, owner: null },
            { id: 9, title: "Watercolor Flower", artist: "SoftBrush", price: 4500, category: "painting", img: "img/9.jpg", sales: 40, isSold: false, owner: null },
            { id: 10, title: "Oil Abstract", artist: "PaletteKnife", price: 6200, category: "painting", img: "img/10.jpg", sales: 25, isSold: false, owner: null },
            { id: 11, title: "Classic Portrait", artist: "ClassicMaster", price: 3500, category: "painting", img: "img/11.jpg", sales: 15, isSold: false, owner: null },
            { id: 12, title: "Sunset Vibe", artist: "ColorBlind", price: 5000, category: "painting", img: "img/12.jpg", sales: 70, isSold: false, owner: null },
            { id: 13, title: "Modern Art", artist: "Modernist", price: 4200, category: "painting", img: "img/13.jpg", sales: 30, isSold: false, owner: null },
            { id: 14, title: "Nature Canvas", artist: "EcoArt", price: 5800, category: "painting", img: "img/14.jpg", sales: 55, isSold: false, owner: null },
            { id: 15, title: "Acrylic Flow", artist: "FluidArt", price: 7000, category: "painting", img: "img/15.jpg", sales: 80, isSold: false, owner: null },
            { id: 16, title: "Impressionist", artist: "OldSchool", price: 8500, category: "painting", img: "img/16.jpg", sales: 10, isSold: false, owner: null },
            { id: 17, title: "Mountain View", artist: "NatureLover", price: 8900, category: "photo", img: "img/17.jpg", sales: 110, isSold: false, owner: null },
            { id: 18, title: "City Night", artist: "StreetShooter", price: 25000, category: "photo", img: "img/18.jpg", sales: 180, isSold: false, owner: null },
            { id: 19, title: "Street Life", artist: "CityWalker", price: 9200, category: "photo", img: "img/19.jpg", sales: 65, isSold: false, owner: null },
            { id: 20, title: "Golden Hour", artist: "SunChaser", price: 6500, category: "photo", img: "img/20.jpg", sales: 95, isSold: false, owner: null },
            { id: 21, title: "Minimalist", artist: "ZenPhoto", price: 13500, category: "photo", img: "img/21.jpg", sales: 130, isSold: false, owner: null },
            { id: 22, title: "Portrait B&W", artist: "MonoLens", price: 5500, category: "photo", img: "img/22.jpg", sales: 40, isSold: false, owner: null },
            { id: 23, title: "Urban Decay", artist: "RustyCam", price: 4800, category: "photo", img: "img/23.jpg", sales: 20, isSold: false, owner: null },
            { id: 24, title: "Forest Mist", artist: "GreenEye", price: 7200, category: "photo", img: "img/24.jpg", sales: 50, isSold: false, owner: null }
        ];

        // ================= SYSTEM LOGIC =================
        function initSystem() {
            if(localStorage.getItem('as_users')) {
                users = JSON.parse(localStorage.getItem('as_users'));
                artworks = JSON.parse(localStorage.getItem('as_artworks'));
            } else {
                users = [...defaultUsers];
                artworks = [...defaultArtworks];
                saveSystem();
            }
            renderTopArtists();
            renderGallery(artworks);
        }

        function saveSystem() {
            localStorage.setItem('as_users', JSON.stringify(users));
            localStorage.setItem('as_artworks', JSON.stringify(artworks));
        }

        function systemReset() {
            if(confirm('üî¥ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ')) {
                localStorage.clear();
                location.reload();
            }
        }

        // ================= AUTH =================
        function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const pass = document.getElementById('regPass').value;

            if(users.find(u => u.email === email)) { alert('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß'); return; }

            const newUser = { email, pass, name, role: 'member' };
            users.push(newUser);
            saveSystem();
            loginUser(newUser);
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            const user = users.find(u => u.email === email && u.pass === pass);
            if(user) loginUser(user);
            else alert('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        }

        function loginUser(user) {
            currentUser = user;
            isAdmin = (user.role === 'admin');
            closeModal('auth-modal');
            
            document.getElementById('guest-nav').classList.add('hidden');
            document.getElementById('user-nav').classList.remove('hidden');
            document.getElementById('user-nav').style.display = 'flex';
            document.getElementById('display-name').textContent = user.name;
            document.getElementById('avatar-circle').textContent = user.name.charAt(0).toUpperCase();
            
            if(isAdmin) {
                document.getElementById('admin-panel').classList.remove('hidden');
                document.getElementById('admin-reset-btn').classList.remove('hidden');
                renderAdminUserList();
            }

            alert(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì ${user.name}`);
            renderGallery(artworks);
        }

        function logout() {
            if(confirm('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?')) location.reload();
        }

        function deleteAccount() {
            if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏≤‡∏ß‡∏£?')) {
                users = users.filter(u => u.email !== currentUser.email);
                saveSystem();
                location.reload();
            }
        }

        // ================= ADMIN =================
        function renderAdminUserList() {
            const list = document.getElementById('admin-user-list');
            list.innerHTML = users.map((u, i) => `
                <div class="user-item">
                    <span>üë§ ${u.name} (${u.email}) - ${u.role}</span>
                    ${u.role !== 'admin' ? `<button onclick="adminDeleteUser(${i})" style="color:var(--danger); border:none; background:none; cursor:pointer;">‡∏•‡∏ö</button>` : ''}
                </div>
            `).join('');
        }

        function adminDeleteUser(index) {
            if(confirm('‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ?')) {
                users.splice(index, 1);
                saveSystem();
                renderAdminUserList();
            }
        }

        // ================= GALLERY & STUDIO =================
        function renderGallery(items, isCollection = false) {
            const gallery = document.getElementById('gallery');
            const fallback = 'https://placehold.co/600x400/EEE/31343C?text=Image+Not+Found';
            
            gallery.innerHTML = items.map(item => {
                const canDelete = (currentUser && currentUser.role === 'admin') || (currentUser && item.artist === currentUser.name);
                const deleteBtn = canDelete ? `<button class="delete-btn" onclick="deleteArt(${item.id}, event)"><i class="fas fa-trash"></i></button>` : '';
                
                // --- LOGIC: Hide SOLD stamp if in My Collection mode ---
                let soldClass = (item.isSold && !isCollection) ? 'sold' : (isCollection ? 'owned' : '');
                let soldOverlay = (item.isSold && !isCollection) ? `<div class="sold-overlay-badge">SOLD</div>` : '';
                
                let badgeText = item.category === 'digital' ? 'Digital' : item.category === 'photo' ? 'Photo' : 'Paint';

                return `
                <div class="art-card ${soldClass}">
                    <div class="card-img-container" onclick="openPreview(${item.id})">
                        <span class="category-badge">${badgeText}</span>
                        ${soldOverlay}
                        ${deleteBtn}
                        <div class="card-overlay"><span class="view-btn">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</span></div>
                        <img src="${item.img}" class="card-img" loading="lazy" onerror="this.src='${fallback}'">
                    </div>
                    <div class="card-body">
                        <h4 class="card-title">${item.title}</h4>
                        <div style="font-size:13px; color:var(--text-muted);"><i class="fas fa-user-circle"></i> ${item.artist}</div>
                        <div class="card-price">‡∏ø${item.price.toLocaleString()}</div>
                    </div>
                </div>`;
            }).join('');
        }

        function openMyStudio() {
            if(!currentUser) return;
            
            // 1. Hide Top Artists Section
            document.getElementById('top-artists-section').classList.add('hidden');
            
            // 2. Change Header Text
            document.getElementById('hero-title').innerHTML = `‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå<br><span>‡πÅ‡∏•‡∏∞‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</span>`;
            document.getElementById('hero-subtitle').textContent = "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏®‡∏¥‡∏•‡∏õ‡∏∞‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà";

            // 3. Show Studio Panel
            document.getElementById('studio-panel').classList.remove('hidden');
            switchStudioTab('upload');
            
            // 4. Highlight Button
            document.getElementById('my-studio-btn').style.borderColor = 'var(--accent)';
            document.getElementById('my-studio-btn').style.color = 'var(--accent)';
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        }

        function switchStudioTab(tab) {
            document.querySelectorAll('.studio-tab').forEach(t => t.classList.remove('active'));
            if(tab === 'upload') {
                document.getElementById('tab-upload').classList.add('active');
                document.getElementById('upload-form').classList.remove('hidden');
                document.getElementById('collection-msg').classList.add('hidden');
                renderGallery(artworks.filter(a => a.artist === currentUser.name), false);
            } else {
                document.getElementById('tab-collection').classList.add('active');
                document.getElementById('upload-form').classList.add('hidden');
                document.getElementById('collection-msg').classList.remove('hidden');
                // Show items bought by user -> Pass true for 'isCollection' to hide SOLD stamps
                renderGallery(artworks.filter(a => a.owner === currentUser.name && a.isSold), true);
            }
        }

        function filterGallery(cat, btn) {
            // Reset View logic if navigating away from studio
            document.getElementById('studio-panel').classList.add('hidden'); 
            document.getElementById('top-artists-section').classList.remove('hidden'); // Show Top Artists again
            document.getElementById('hero-title').innerHTML = `‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡∏≤‡∏°<br><span>‡∏ó‡∏µ‡πà‡πÑ‡∏£‡πâ‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î</span>`;
            document.getElementById('hero-subtitle').textContent = "‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡∏£‡∏±‡∏Å‡∏®‡∏¥‡∏•‡∏õ‡∏∞ ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏≤‡∏ü‡∏ï‡πå‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß";

            document.getElementById('my-studio-btn').style.borderColor = 'transparent';
            document.getElementById('my-studio-btn').style.color = 'var(--text-muted)';

            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');

            if(cat === 'all') renderGallery(artworks);
            else if(cat === 'sold') renderGallery(artworks.filter(a => a.isSold));
            else renderGallery(artworks.filter(a => a.category === cat));
        }

        function renderTopArtists() {
            const sorted = [...artworks].sort((a,b) => b.sales - a.sales).slice(0,3);
            document.getElementById('top-artists-grid').innerHTML = sorted.map((a,i) => `
                <div class="artist-rank-card">
                    <div class="rank-badge">${i+1}</div>
                    <img src="${a.img}" class="artist-img">
                    <div class="artist-name">${a.artist}</div>
                    <div class="artist-sales">‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß ${a.sales} ‡∏ä‡∏¥‡πâ‡∏ô</div>
                </div>
            `).join('');
        }

        function searchGallery() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const filtered = artworks.filter(a => a.title.toLowerCase().includes(term) || a.artist.toLowerCase().includes(term));
            renderGallery(filtered);
        }

        function resetView() { location.reload(); }

        // ================= 3. AUTH & USER MANAGEMENT (FIXED TOGGLE) =================
        function openAuthModal(mode='login') {
            document.getElementById('auth-modal').classList.add('open');
            toggleAuth(mode);
        }

        function closeModal(id) { document.getElementById(id).classList.remove('open'); }

        function toggleAuth(mode) {
            if(mode === 'register') {
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('register-section').classList.remove('hidden');
                document.getElementById('auth-title').innerText = '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà';
            } else {
                document.getElementById('login-section').classList.remove('hidden');
                document.getElementById('register-section').classList.add('hidden');
                document.getElementById('auth-title').innerText = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
            }
        }

        function openPreview(id) {
            const item = artworks.find(a => a.id === id);
            if(!item) return;
            selectedItemForPay = item;
            
            document.getElementById('modal-img').src = item.img;
            document.getElementById('modal-title').textContent = item.title;
            document.getElementById('modal-artist').textContent = item.artist;
            document.getElementById('modal-price').textContent = `‡∏ø${item.price.toLocaleString()}`;
            
            const btn = document.getElementById('modal-buy-btn');
            // If viewing in collection mode (owned), show "You own this" or disable button
            // If normal mode and sold, show Sold
            const isOwned = (currentUser && item.owner === currentUser.name);

            if(item.isSold) {
                if(isOwned) {
                    btn.innerHTML = '<i class="fas fa-check"></i> ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß';
                    btn.disabled = true;
                    btn.style.background = 'var(--success)';
                } else {
                    btn.innerHTML = '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß';
                    btn.disabled = true;
                    btn.style.background = '#333';
                }
            } else {
                btn.innerHTML = '<i class="fas fa-shopping-cart"></i> ‡∏ã‡∏∑‡πâ‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ';
                btn.disabled = false;
                btn.style.background = 'var(--gradient-btn)';
            }
            
            document.getElementById('preview-modal').classList.add('open');
        }

        function openPayment() {
            if(!currentUser) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'); return; }
            closeModal('preview-modal');
            document.getElementById('pay-item-name').textContent = `‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${selectedItemForPay.title}`;
            document.getElementById('pay-amount').value = `‡∏ø${selectedItemForPay.price.toLocaleString()}`;
            document.getElementById('payment-modal').classList.add('open');
        }

        function confirmPayment(e) {
            e.preventDefault();
            closeModal('payment-modal');
            
            // Mark Sold & Transfer Ownership
            selectedItemForPay.isSold = true;
            selectedItemForPay.owner = currentUser.name; 
            selectedItemForPay.sales++;
            
            saveSystem();
            renderTopArtists();
            
            // If in studio, reload studio collection. Else reload general gallery
            if(!document.getElementById('studio-panel').classList.contains('hidden')) {
                switchStudioTab('collection');
            } else {
                filterGallery('all', document.querySelector('.filter-btn'));
            }

            document.getElementById('success-modal').classList.add('open');
        }

        function handleUpload(e) {
            e.preventDefault();
            const file = document.getElementById('upImage').files[0];
            const reader = new FileReader();
            reader.onload = function(evt) {
                const newArt = {
                    id: Date.now(),
                    title: document.getElementById('upTitle').value,
                    price: Number(document.getElementById('upPrice').value),
                    category: document.getElementById('upCategory').value,
                    artist: currentUser.name,
                    owner: currentUser.name,
                    img: evt.target.result,
                    isSold: false,
                    sales: 0
                };
                artworks.unshift(newArt);
                saveSystem();
                renderGallery(artworks.filter(a => a.artist === currentUser.name));
                e.target.reset();
                alert('‡∏•‡∏á‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            }
            reader.readAsDataURL(file);
        }

        function deleteArt(id, event) {
            event.stopPropagation();
            if(confirm('‡∏•‡∏ö‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ?')) {
                artworks = artworks.filter(a => a.id !== id);
                saveSystem();
                // Check where we are deleting from to refresh correct view
                if(!document.getElementById('studio-panel').classList.contains('hidden')) {
                     // In studio mode, simplistic refresh:
                     const activeTab = document.querySelector('.studio-tab.active').id;
                     if(activeTab === 'tab-upload') renderGallery(artworks.filter(a => a.artist === currentUser.name));
                     else renderGallery(artworks.filter(a => a.owner === currentUser.name && a.isSold), true);
                } else {
                    renderGallery(artworks);
                }
            }
        }

        // START
        initSystem();

    </script>
</body>
</html>